{"id":"mpVp","dependencies":[{"name":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\package.json","includedInParent":true,"mtime":1720181853972},{"name":"textalive-app-api","loc":{"line":1,"column":23,"index":23},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\textalive-app-api\\dist\\index.es.js"},{"name":"three","loc":{"line":2,"column":23,"index":68},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\build\\three.module.js"},{"name":"three/examples/jsm/loaders/FontLoader.js","loc":{"line":3,"column":27,"index":105},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\examples\\jsm\\loaders\\FontLoader.js"},{"name":"three/examples/jsm/geometries/TextGeometry.js","loc":{"line":4,"column":29,"index":179},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\examples\\jsm\\geometries\\TextGeometry.js"},{"name":"three/examples/jsm/controls/OrbitControls.js","loc":{"line":5,"column":30,"index":259},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\examples\\jsm\\controls\\OrbitControls.js"}],"generated":{"js":"\"use strict\";var e,t,n,o,i,r=require(\"textalive-app-api\"),a=u(require(\"three\")),d=require(\"three/examples/jsm/loaders/FontLoader.js\"),s=require(\"three/examples/jsm/geometries/TextGeometry.js\"),l=require(\"three/examples/jsm/controls/OrbitControls.js\");function c(e){if(\"function\"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||\"object\"!=typeof e&&\"function\"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(\"default\"!==r&&{}.hasOwnProperty.call(e,r)){var a=i?Object.getOwnPropertyDescriptor(e,r):null;a&&(a.get||a.set)?Object.defineProperty(o,r,a):o[r]=e[r]}return o.default=e,n&&n.set(e,o),o}var m,p=\"\",h=[],f=[],v=100,y=0,g={},w=[],I=null,E=!1,M=\"\",B=\"\",b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),P=document.getElementById(\"startButton\"),L=document.getElementById(\"songSelect\"),S=document.querySelector(\"#overlay\");S.className=\"disabled\",P.addEventListener(\"click\",function(){M=L.value,document.getElementById(\"startScreen\").classList.add(\"hidden\"),document.getElementById(\"mainApp\").classList.remove(\"hidden\"),S.className=\"abled\",x.createFromSongUrl(M)});var k={hZ35:{url:\"https://piapro.jp/t/hZ35/20240130103028\",video:{beatId:4592293,chordId:2727635,repetitiveSegmentId:2824326,lyricId:59415,lyricDiffId:13962}},\"--OD\":{url:\"https://piapro.jp/t/--OD/20240202150903\",video:{beatId:4592296,chordId:2727636,repetitiveSegmentId:2824327,lyricId:59416,lyricDiffId:13963}},XiaI:{url:\"https://piapro.jp/t/XiaI/20240201203346\",video:{beatId:4592297,chordId:2727637,repetitiveSegmentId:2824328,lyricId:59417,lyricDiffId:13964}},Rejk:{url:\"https://piapro.jp/t/Rejk/20240202164429\",video:{beatId:4592298,chordId:2727638,repetitiveSegmentId:2824329,lyricId:59418,lyricDiffId:13965}},ELIC:{url:\"https://piapro.jp/t/ELIC/20240130010349\",video:{beatId:4592299,chordId:2727639,repetitiveSegmentId:2824330,lyricId:59419,lyricDiffId:13966}},xEA7:{url:\"https://piapro.jp/t/xEA7/20240202002556\",video:{beatId:4592300,chordId:2727640,repetitiveSegmentId:2824331,lyricId:59420,lyricDiffId:13967}}},x=new r.Player({app:{token:\"GfeiLX99kNC1YEyp\"},valenceArousalEnabled:!0,vocalAmplitudeEnabled:!0,mediaElement:document.createElement(\"audio\")});function A(){(new d.FontLoader).load(\"Zen Old Mincho Black_Regular.json\",function(e){I=e})}function j(){var e,t=document.getElementById(\"playBtn\"),n=document.getElementById(\"pauseBtn\"),o=document.getElementById(\"explodeBtn\"),i=document.getElementById(\"volumeSlider\"),r=document.getElementById(\"hamburger-menu\"),a=document.getElementById(\"controls\"),d=document.getElementById(\"seekbar\");t.addEventListener(\"click\",D),n.addEventListener(\"click\",F),i.addEventListener(\"input\",R),r.addEventListener(\"click\",function(){a.classList.toggle(\"hidden\")}),d.addEventListener(\"input\",O),o.addEventListener(\"touchstart\",function(){e=Date.now()}),o.addEventListener(\"touchend\",function(){Date.now()-e<300&&q()}),o.addEventListener(\"click\",q),document.getElementById(\"startButton\").addEventListener(\"click\",function(){document.getElementById(\"startScreen\").classList.add(\"hidden\"),document.getElementById(\"mainApp\").classList.remove(\"hidden\")});var s=document.createElement(\"button\");s.textContent=\"球面モード切替\",s.addEventListener(\"click\",C),document.getElementById(\"controls\").appendChild(s)}function C(){E=!E,z()}function D(){x.requestPlay()}function F(){x.requestPause()}function O(){var e=document.getElementById(\"seekbar\");x.requestMediaSeek(e.value)}function R(){var e=document.getElementById(\"volumeSlider\").value/100;x.volume=100*e,console.log(\"Player media element volume:\",x.mediaElement.volume)}function T(e){document.getElementById(\"currentLyrics\").textContent=e}function q(){h.forEach(function(e){var t=new a.Vector3(.5*(Math.random()-.5),.5*(Math.random()-.5),.5*(Math.random()-.5));e.position.add(t)}),G()}function z(){f.forEach(function(n){e.remove(n.mesh),t.remove(n.trail)}),f=[]}function G(){for(var e=b?50:100,n=new a.BufferGeometry,o=new Float32Array(3*e),i=new Float32Array(3*e),r=new Float32Array(3*e),d=new Float32Array(3*e),s=new a.Color,l=0;l<e;l++){var c=10*(Math.random()-.5),u=10*(Math.random()-.5),p=10*(Math.random()-.5);o[3*l]=c,o[3*l+1]=u,o[3*l+2]=p,r[3*l]=.1*(Math.random()-.5),r[3*l+1]=-.1*Math.random()-.05,r[3*l+2]=.1*(Math.random()-.5),d[3*l]=Math.random()*Math.PI*2,d[3*l+1]=Math.random()*Math.PI*2,d[3*l+2]=Math.random()*Math.PI*2,s.setHSL(Math.random(),1,.5),i[3*l]=s.r,i[3*l+1]=s.g,i[3*l+2]=s.b}n.setAttribute(\"position\",new a.BufferAttribute(o,3)),n.setAttribute(\"color\",new a.BufferAttribute(i,3));var h=new a.PointsMaterial({size:.1,vertexColors:!0});(m=new a.Points(n,h)).userData.velocities=r,m.userData.rotations=d,t.add(m),setTimeout(function(){t.remove(m),m.geometry.dispose(),m.material.dispose(),m=null},3e3)}function V(){if(m){for(var e=m.geometry.attributes.position.array,t=m.userData.velocities,n=m.userData.rotations,o=0;o<e.length;o+=3){e[o]+=t[o],e[o+1]+=t[o+1],e[o+2]+=t[o+2],t[o+1]-=.0098,n[o]+=.01,n[o+1]+=.01,n[o+2]+=.01;var i=.3*Math.sin(n[o])+.7;m.geometry.attributes.position.array[o]*=i,m.geometry.attributes.position.array[o+1]*=i}m.geometry.attributes.position.needsUpdate=!0}}function W(){var r;t=new a.Scene,(n=new a.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3)).position.set(0,0,30),o=new a.WebGLRenderer({antialias:!1,powerPreference:\"low-power\"}),b?o.setPixelRatio(1):o.setPixelRatio(Math.min(window.devicePixelRatio,2)),o.setSize(window.innerWidth,window.innerHeight),document.getElementById(\"container\").appendChild(o.domElement),(new a.TextureLoader).load(\"starry_sky.jpg\",function(e){e.minFilter=a.LinearFilter,t.background=e}),t.background=new a.Color(0),n.position.z=5,(i=new l.OrbitControls(n,o.domElement)).enableDamping=!0,i.dampingFactor=.25,i.screenSpacePanning=!1,i.minDistance=1,i.maxDistance=100,e=new a.Group,t.add(e),_(),Q(),window.addEventListener(\"resize\",function(){clearTimeout(r),r=setTimeout($,100)})}function _(){var e=new a.SphereGeometry(50,64,64),n=H(),o=new a.MeshBasicMaterial({map:n,side:a.BackSide,transparent:!0,opacity:.8}),i=new a.Mesh(e,o);t.add(i)}function H(){var e=document.createElement(\"canvas\");e.width=1024,e.height=1024;var t=e.getContext(\"2d\");t.fillStyle=\"black\",t.fillRect(0,0,1024,1024);for(var n=0;n<1e3;n++){var o=2*Math.random(),i=1024*Math.random(),r=1024*Math.random();t.beginPath(),t.arc(i,r,o,0,2*Math.PI),t.fillStyle=\"white\",t.fill()}return new a.CanvasTexture(e)}function N(){if(p&&I){var n=b?3:5;p.split(/\\s+/).slice(0,n).forEach(function(n,o){g[n]||(g[n]=new s.TextGeometry(n,{font:I,size:2,height:.5}),g[n].center());var i=Z(n,new a.MeshBasicMaterial({color:16777215}));if(E){var r=U(95);i.position.copy(r),i.lookAt(new a.Vector3(0,0,0))}else i.position.set(40*(Math.random()-.5),20+5*o,40*(Math.random()-.5));var d=(new a.Color).setHSL(Math.random(),1,.5),l=new a.Line(new a.BufferGeometry,new a.LineBasicMaterial({color:d,transparent:!0,linewidth:3}));l.geometry.setFromPoints([i.position.clone()]),t.add(l),f.push({mesh:i,trail:l,positions:[i.position.clone()],opacities:[1],speed:.05+.05*Math.random(),rotationSpeed:{x:.02*(Math.random()-.5),y:.02*(Math.random()-.5),z:.02*(Math.random()-.5)},sphericalPosition:E?X():null}),e.add(i)})}}function U(e){var t=Math.random()*Math.PI*2,n=Math.acos(2*Math.random()-1),o=e*Math.sin(n)*Math.cos(t),i=e*Math.sin(n)*Math.sin(t),r=e*Math.cos(n);return new a.Vector3(o,i,r)}function X(){return{theta:Math.random()*Math.PI*2,phi:Math.acos(2*Math.random()-1)}}function Z(e,t){if(w.length>0){var n=w.pop();return n.geometry=g[e],n.material=t,n}return new a.Mesh(g[e],t)}function Y(e){w.length<50?w.push(e):ee(e)}function J(){var e=x.timer.position;if(e){var t=x.getValenceArousal(e);if(t){var n=t.v,o=t.a;if(void 0!==n&&void 0!==o){console.log(\"Valence: \".concat(n,\", Arousal: \").concat(o));var i=new a.Color;return console.log(i),i.setHSL((n+1)/2,1,(o+1)/2),i}console.error(\"感情値が未定義です。\")}else console.error(\"感情値の取得に失敗しました。\")}else console.error(\"プレイヤーの位置が無効です。\")}function K(){for(var n=J(),o=f.length-1;o>=0;o--){var i=f[o];if(i.mesh.material.color.copy(n),E){i.sphericalPosition.theta+=.005,i.sphericalPosition.phi+=.002;var r=new a.Vector3(95*Math.sin(i.sphericalPosition.phi)*Math.cos(i.sphericalPosition.theta),95*Math.sin(i.sphericalPosition.phi)*Math.sin(i.sphericalPosition.theta),95*Math.cos(i.sphericalPosition.phi));i.mesh.position.copy(r),i.mesh.lookAt(new a.Vector3(0,0,0))}else i.mesh.position.y-=i.speed,i.mesh.rotation.x+=i.rotationSpeed.x,i.mesh.rotation.y+=i.rotationSpeed.y,i.mesh.rotation.z+=i.rotationSpeed.z;i.positions.push(i.mesh.position.clone()),i.opacities.push(1),i.positions.length>v&&(i.positions.shift(),i.opacities.shift());for(var d=0;d<i.opacities.length;d++)i.opacities[d]*=.99;var s=(new a.BufferGeometry).setFromPoints(i.positions),l=i.trail.material.clone();l.color.copy(n),l.opacity=1;for(var c=new Float32Array(3*i.positions.length),u=0;u<i.positions.length;u++){var m=new a.Color(l.color);m.multiplyScalar(i.opacities[u]),c[3*u]=m.r,c[3*u+1]=m.g,c[3*u+2]=m.b}s.setAttribute(\"color\",new a.BufferAttribute(c,3)),l.vertexColors=!0,t.remove(i.trail),i.trail=new a.Line(s,l),t.add(i.trail),(!E&&i.mesh.position.y<-50||E&&i.opacities[0]<.01)&&(e.remove(i.mesh),t.remove(i.trail),f.splice(o,1),Y(i.mesh))}}function Q(e){requestAnimationFrame(Q),e-y>1e3/(b?20:30)&&(y=e,K(),V(),i.update(),o&&n&&o.render(t,n))}function $(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),o.setSize(window.innerWidth,window.innerHeight)}function ee(e){e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){return e.dispose()}):e.material.dispose())}function te(){h.forEach(function(e){ee(e)}),h=[],f.forEach(function(e){t.remove(e.trail),e.trail.geometry.dispose(),e.trail.material.dispose()}),f=[],m&&(t.remove(m),m.geometry.dispose(),m.material.dispose(),m=null),Object.values(g).forEach(function(e){return e.dispose()}),g={},w.forEach(function(e){return ee(e)}),w=[]}function ne(e,t){var n;return function(){for(var o=this,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout(function(){return e.apply(o,r)},t)}}x.addListener({onAppReady:function(e){e.managed,j()},onVideoReady:function(e){document.getElementById(\"playBtn\").disabled=!1,document.getElementById(\"pauseBtn\").disabled=!1,document.getElementById(\"explodeBtn\").disabled=!1,document.getElementById(\"seekbar\").max=x.video.duration},onTimerReady:function(){W(),S.className=\"disabled\"},onTimeUpdate:function(e){if(x.video){var t=x.timer.position,n=x.video.findChar(t),o=x.video.findPhrase(t);n&&n.text!==p&&(p=n.text,oe(),T(o.text)),J(),document.getElementById(\"seekbar\").value=t}},onPlay:function(){document.getElementById(\"playBtn\").disabled=!0,document.getElementById(\"pauseBtn\").disabled=!1},onPause:function(){document.getElementById(\"playBtn\").disabled=!1,document.getElementById(\"pauseBtn\").disabled=!0}}),P.addEventListener(\"click\",function(){B=L.value;var e=k[B];e&&(document.getElementById(\"startScreen\").classList.add(\"hidden\"),document.getElementById(\"mainApp\").classList.remove(\"hidden\"),x.createFromSongUrl(e.url,{video:e.video}))}),A(),window.addEventListener(\"beforeunload\",te);var oe=ne(N,300);"},"sourceMaps":null,"error":null,"hash":"47439bf9736fd20cec48b177870690bd","cacheData":{"env":{}}}