{"id":"mpVp","dependencies":[{"name":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\package.json","includedInParent":true,"mtime":1720181853972},{"name":"textalive-app-api","loc":{"line":1,"column":23,"index":23},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\textalive-app-api\\dist\\index.es.js"},{"name":"three","loc":{"line":2,"column":23,"index":68},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\build\\three.module.js"},{"name":"three/examples/jsm/loaders/FontLoader.js","loc":{"line":3,"column":27,"index":105},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\examples\\jsm\\loaders\\FontLoader.js"},{"name":"three/examples/jsm/geometries/TextGeometry.js","loc":{"line":4,"column":29,"index":179},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\examples\\jsm\\geometries\\TextGeometry.js"},{"name":"three/examples/jsm/controls/OrbitControls.js","loc":{"line":5,"column":30,"index":259},"parent":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\src\\script.js","resolved":"C:\\Users\\81805\\Desktop\\textalive-music-app - コピー\\node_modules\\three\\examples\\jsm\\controls\\OrbitControls.js"}],"generated":{"js":"\"use strict\";var e,t,n,r,o,i=require(\"textalive-app-api\"),a=u(require(\"three\")),s=require(\"three/examples/jsm/loaders/FontLoader.js\"),d=require(\"three/examples/jsm/geometries/TextGeometry.js\"),c=require(\"three/examples/jsm/controls/OrbitControls.js\");function l(e){if(\"function\"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||\"object\"!=typeof e&&\"function\"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(\"default\"!==i&&{}.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}function m(e,t,n){if(h())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&p(o,n.prototype),o}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(h=function(){return!!e})()}function f(e){return w(e)||g(e)||v(e)||y()}function y(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function v(e,t){if(e){if(\"string\"==typeof e)return M(e,t);var n={}.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function g(e){if(\"undefined\"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e[\"@@iterator\"])return Array.from(e)}function w(e){if(Array.isArray(e))return M(e)}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var b,I=\"\",E=\"\",B=[],P=[],L=[],A=[],S=100,x={},k=[],j=null,C=!1,D=\"\",O=\"\",F=new a.Raycaster,T=new a.Vector2,R=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),V=document.getElementById(\"startButton\"),H=document.getElementById(\"songSelect\"),z=document.querySelector(\"#overlay\"),G=document.getElementById(\"currentLyrics\");z.className=\"disabled\",V.addEventListener(\"click\",function(){D=H.value,document.getElementById(\"startScreen\").classList.add(\"hidden\"),document.getElementById(\"mainApp\").classList.remove(\"hidden\"),z.className=\"abled\",W.createFromSongUrl(D)});var _={hZ35:{url:\"https://piapro.jp/t/hZ35/20240130103028\",video:{beatId:4592293,chordId:2727635,repetitiveSegmentId:2824326,lyricId:59415,lyricDiffId:13962}},\"--OD\":{url:\"https://piapro.jp/t/--OD/20240202150903\",video:{beatId:4592296,chordId:2727636,repetitiveSegmentId:2824327,lyricId:59416,lyricDiffId:13963}},XiaI:{url:\"https://piapro.jp/t/XiaI/20240201203346\",video:{beatId:4592297,chordId:2727637,repetitiveSegmentId:2824328,lyricId:59417,lyricDiffId:13964}},Rejk:{url:\"https://piapro.jp/t/Rejk/20240202164429\",video:{beatId:4592298,chordId:2727638,repetitiveSegmentId:2824329,lyricId:59418,lyricDiffId:13965}},ELIC:{url:\"https://piapro.jp/t/ELIC/20240130010349\",video:{beatId:4592299,chordId:2727639,repetitiveSegmentId:2824330,lyricId:59419,lyricDiffId:13966}},xEA7:{url:\"https://piapro.jp/t/xEA7/20240202002556\",video:{beatId:4592300,chordId:2727640,repetitiveSegmentId:2824331,lyricId:59420,lyricDiffId:13967}}},W=new i.Player({app:{token:\"GfeiLX99kNC1YEyp\"},valenceArousalEnabled:!0,vocalAmplitudeEnabled:!0,mediaElement:document.createElement(\"audio\")});function q(){(new s.FontLoader).load(\"Zen Old Mincho Black_Regular.json\",function(e){j=e})}function U(){var e=document.getElementById(\"playBtn\"),t=document.getElementById(\"pauseBtn\"),n=document.getElementById(\"volumeSlider\"),r=document.getElementById(\"hamburger-menu\"),o=document.getElementById(\"controls\"),i=document.getElementById(\"seekbar\");e.addEventListener(\"click\",N),t.addEventListener(\"click\",Y),n.addEventListener(\"input\",$),r.addEventListener(\"click\",function(){o.classList.toggle(\"hidden\")}),i.addEventListener(\"input\",Z),document.getElementById(\"startButton\").addEventListener(\"click\",function(){document.getElementById(\"startScreen\").classList.add(\"hidden\"),document.getElementById(\"mainApp\").classList.remove(\"hidden\")});var a=document.createElement(\"button\");a.textContent=\"球面モード切替\",a.addEventListener(\"click\",X),document.getElementById(\"controls\").appendChild(a)}function X(){C=!C,ee()}function N(){W.requestPlay()}function Y(){W.requestPause()}function Z(){var e=document.getElementById(\"seekbar\");W.requestMediaSeek(e.value)}function $(){var e=document.getElementById(\"volumeSlider\").value/100;W.volume=100*e}function J(e){var t=W.timer.position;W.video.findPhrase(t);G.innerHTML=\"\",e.split(\" \").forEach(function(e,t){var n=document.createElement(\"span\");n.textContent=e+\" \",n.style.animationDelay=\"\".concat(.1*t,\"s\");var r=new a.Color;r.setHSL(Math.random(),1,.5),n.style.color=\"#\".concat(r.getHexString()),G.appendChild(n)}),G.classList.add(\"show\")}function K(){B.forEach(function(e){var t=new a.Vector3(.5*(Math.random()-.5),.5*(Math.random()-.5),.5*(Math.random()-.5));e.position.add(t)}),te()}function Q(n){var r=new a.Vector3(.5*(Math.random()-.5),.5*(Math.random()-.5),.5*(Math.random()-.5));n.position.add(r),e.remove(n),t.remove(n),ne(n.position,100*n.scale.x)}function ee(){P.forEach(function(n){e.remove(n.mesh),t.remove(n.trail)}),P=[]}function te(){for(var e=R?50:100,n=new a.BufferGeometry,r=new Float32Array(3*e),o=new Float32Array(3*e),i=new Float32Array(3*e),s=new Float32Array(3*e),d=new a.Color,c=0;c<e;c++){var l=10*(Math.random()-.5),u=10*(Math.random()-.5),m=10*(Math.random()-.5);r[3*c]=l,r[3*c+1]=u,r[3*c+2]=m,i[3*c]=.1*(Math.random()-.5),i[3*c+1]=-.1*Math.random()-.05,i[3*c+2]=.1*(Math.random()-.5),s[3*c]=Math.random()*Math.PI*2,s[3*c+1]=Math.random()*Math.PI*2,s[3*c+2]=Math.random()*Math.PI*2,d.setHSL(Math.random(),1,.5),o[3*c]=d.r,o[3*c+1]=d.g,o[3*c+2]=d.b}n.setAttribute(\"position\",new a.BufferAttribute(r,3)),n.setAttribute(\"color\",new a.BufferAttribute(o,3));var p=new a.PointsMaterial({size:.1,vertexColors:!0});(b=new a.Points(n,p)).userData.velocities=i,b.userData.rotations=s,t.add(b),setTimeout(function(){t.remove(b),b.geometry.dispose(),b.material.dispose(),b=null},3e3)}function ne(e,n){for(var r=Math.floor(150*n),o=new a.BufferGeometry,i=new Float32Array(3*r),s=new Float32Array(3*r),d=new Float32Array(3*r),c=new a.Color,l=0;l<r;l++)i[3*l]=e.x,i[3*l+1]=e.y,i[3*l+2]=e.z,d[3*l]=3*(Math.random()-.5)*n,d[3*l+1]=3*(Math.random()-.5)*n,d[3*l+2]=3*(Math.random()-.5)*n,c.setHSL(Math.random(),1,.7),s[3*l]=c.r,s[3*l+1]=c.g,s[3*l+2]=c.b;o.setAttribute(\"position\",new a.BufferAttribute(i,3)),o.setAttribute(\"color\",new a.BufferAttribute(s,3));var u=new a.PointsMaterial({size:.15,vertexColors:!0}),m=new a.Points(o,u);m.userData.velocities=d,t.add(m),A.push(m),setTimeout(function(){t.remove(m),m.geometry.dispose(),m.material.dispose()},2500)}function re(){A.forEach(function(e,t){for(var n=e.geometry.attributes.position.array,r=e.userData.velocities,o=0;o<n.length;o+=3)n[o]+=.1*r[o],n[o+1]+=.1*r[o+1],n[o+2]+=.1*r[o+2],r[o]*=.98,r[o+1]*=.98,r[o+2]*=.98,r[o+1]-=.005;e.geometry.attributes.position.needsUpdate=!0,r[1]<-2&&A.splice(t,1)})}function oe(){if(b){for(var e=b.geometry.attributes.position.array,t=b.userData.velocities,n=b.userData.rotations,r=0;r<e.length;r+=3){e[r]+=t[r],e[r+1]+=t[r+1],e[r+2]+=t[r+2],t[r+1]-=.0098,n[r]+=.01,n[r+1]+=.01,n[r+2]+=.01;var o=.3*Math.sin(n[r])+.7;b.geometry.attributes.position.array[r]*=o,b.geometry.attributes.position.array[r+1]*=o}b.geometry.attributes.position.needsUpdate=!0}}function ie(){var i;t=new a.Scene,(n=new a.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3)).position.set(0,0,250),r=new a.WebGLRenderer({antialias:!1,powerPreference:\"high-performance\"}),R?r.setPixelRatio(1):r.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.setSize(window.innerWidth,window.innerHeight),document.getElementById(\"container\").appendChild(r.domElement),(new a.TextureLoader).load(\"starry_sky.jpg\",function(e){e.minFilter=a.LinearFilter,t.background=e}),t.background=new a.Color(0),(o=new c.OrbitControls(n,r.domElement)).enableDamping=!0,o.dampingFactor=.25,o.screenSpacePanning=!1,o.minDistance=1,o.maxDistance=500,e=new a.Group,t.add(e),ae(),Ee(),window.addEventListener(\"resize\",function(){clearTimeout(i),i=setTimeout(Be,100)}),window.addEventListener(\"click\",ge,!1),window.addEventListener(\"touchstart\",we,!1)}function ae(){var e=new a.SphereGeometry(95,64,64),n=se(),r=new a.MeshBasicMaterial({map:n,side:a.BackSide,transparent:!0,opacity:.8}),o=new a.Mesh(e,r);t.add(o),de()}function se(){var e=document.createElement(\"canvas\");e.width=1024,e.height=1024;var t=e.getContext(\"2d\");t.fillStyle=\"black\",t.fillRect(0,0,1024,1024);for(var n=0;n<1e3;n++){var r=2*Math.random(),o=1024*Math.random(),i=1024*Math.random();t.beginPath(),t.arc(o,i,r,0,2*Math.PI),t.fillStyle=\"white\",t.fill()}return new a.CanvasTexture(e)}function de(){var e=(new a.BufferGeometry).setFromPoints([[[-30,40,0],[-10,30,0],[10,35,0],[30,20,0]],[[40,-20,0],[20,-30,0],[0,-40,0],[-20,-30,0],[-40,-20,0]],[[-50,10,0],[-30,5,0],[-10,15,0],[10,5,0],[30,10,0]]].map(function(e){return m(a.Vector3,f(e))})),n=new a.LineBasicMaterial({color:13421772,opacity:.5,transparent:!0}),r=new a.Line(e,n);t.add(r)}function ce(){var e=new a.BufferGeometry,n=new a.LineBasicMaterial({color:16777215}),r=new a.CubicBezierCurve3(new a.Vector3(-100,100*Math.random()-50,100*Math.random()-50),new a.Vector3(-33,100*Math.random()-50,100*Math.random()-50),new a.Vector3(33,100*Math.random()-50,100*Math.random()-50),new a.Vector3(100,100*Math.random()-50,100*Math.random()-50)),o=r.getPoints(50);e.setFromPoints(o);var i=new a.Line(e,n);return i.userData.progress=0,i.userData.speed=.005+.01*Math.random(),i.userData.curve=r,t.add(i),i}function le(){for(var e=L.length-1;e>=0;e--){var n=L[e];if(n.userData.progress+=n.userData.speed,n.userData.progress>1)t.remove(n),n.geometry.dispose(),n.material.dispose(),L.splice(e,1);else{var r=n.geometry.attributes.position,o=n.userData.curve.getPointAt(n.userData.progress);r.setXYZ(r.count-1,o.x,o.y,o.z),r.needsUpdate=!0}}Math.random()<.02&&L.length<5&&L.push(ce())}function ue(){if(I&&j){var n=I.split(\"\"),r=ye();n.forEach(function(n,o){x[n]||(x[n]=new d.TextGeometry(n,{font:j,size:10,height:1}),x[n].center());var i=he(n,new a.MeshBasicMaterial({color:r}));if(C){var s=me(95);i.position.copy(s),i.lookAt(new a.Vector3(0,0,0))}else i.position.set(100*(Math.random()-.5),20+5*o,100*(Math.random()-.5));var c=(new a.Color).setHSL(Math.random(),1,.5),l=new a.Line(new a.BufferGeometry,new a.LineBasicMaterial({color:c,transparent:!0,linewidth:3}));l.geometry.setFromPoints([i.position.clone()]),t.add(l),P.push({mesh:i,trail:l,positions:[i.position.clone()],opacities:[1],speed:.05+.05*Math.random(),rotationSpeed:{x:.02*(Math.random()-.5),y:.02*(Math.random()-.5),z:.02*(Math.random()-.5)},sphericalPosition:C?pe():null,fixedColor:r}),e.add(i)})}}function me(e){var t=Math.random()*Math.PI*2,n=Math.random()*Math.PI,r=e*Math.sin(n)*Math.cos(t),o=e*Math.sin(n)*Math.sin(t),i=e*Math.cos(n);return new a.Vector3(r,o,i)}function pe(){return{theta:Math.random()*Math.PI*2,phi:Math.acos(2*Math.random()-1)}}function he(e,t){if(k.length>0){var n=k.pop();return n.geometry=x[e],n.material=t,n}return new a.Mesh(x[e],t)}function fe(e){k.length<50?k.push(e):Pe(e)}function ye(){var e=W.timer.position,t=W.getValenceArousal(e);if(t){var n=t.v,r=t.a,o=new a.Color,i=(1-n)/3,s=(r+1)/2*.5+.25;return o.setHSL(i,1,s),o}console.error(\"感情値の取得に失敗しました。\")}function ve(){for(var n=P.length-1;n>=0;n--){var r=P[n];if(r.mesh.material.color.copy(r.fixedColor),C){r.sphericalPosition.theta+=.005,r.sphericalPosition.phi+=.002;var o=new a.Vector3(95*Math.sin(r.sphericalPosition.phi)*Math.cos(r.sphericalPosition.theta),95*Math.sin(r.sphericalPosition.phi)*Math.sin(r.sphericalPosition.theta),95*Math.cos(r.sphericalPosition.phi));r.mesh.position.copy(o),r.mesh.lookAt(new a.Vector3(0,0,0))}else r.mesh.position.y-=r.speed,r.mesh.rotation.x+=r.rotationSpeed.x,r.mesh.rotation.y+=r.rotationSpeed.y,r.mesh.rotation.z+=r.rotationSpeed.z;r.positions.push(r.mesh.position.clone()),r.opacities.push(1),r.positions.length>S&&(r.positions.shift(),r.opacities.shift());for(var i=0;i<r.opacities.length;i++)r.opacities[i]*=.99;var s=(new a.BufferGeometry).setFromPoints(r.positions),d=r.trail.material.clone();d.color.copy(r.fixedColor),d.opacity=1;for(var c=new Float32Array(3*r.positions.length),l=0;l<r.positions.length;l++){var u=new a.Color(d.color);u.multiplyScalar(r.opacities[l]),c[3*l]=u.r,c[3*l+1]=u.g,c[3*l+2]=u.b}s.setAttribute(\"color\",new a.BufferAttribute(c,3)),d.vertexColors=!0,t.remove(r.trail),r.trail=new a.Line(s,d),t.add(r.trail),(!C&&r.mesh.position.y<-50||C&&r.opacities[0]<.01)&&(e.remove(r.mesh),t.remove(r.trail),P.splice(n,1),fe(r.mesh))}}function ge(t){t.preventDefault(),T.x=t.clientX/window.innerWidth*2-1,T.y=-t.clientY/window.innerHeight*2+1,F.setFromCamera(T,n);var r=F.intersectObjects(e.children,!0);r.length>0&&Q(r[0].object)}function we(t){t.preventDefault();var r=t.touches[0];T.x=r.clientX/window.innerWidth*2-1,T.y=-r.clientY/window.innerHeight*2+1,F.setFromCamera(T,n);var o=F.intersectObjects(e.children,!0);o.length>0&&Q(o[0].object)}W.addListener({onAppReady:function(e){U()},onVideoReady:function(e){document.getElementById(\"playBtn\").disabled=!1,document.getElementById(\"pauseBtn\").disabled=!1,document.getElementById(\"seekbar\").max=W.video.duration},onTimerReady:function(){ie(),z.className=\"disabled\"},onTimeUpdate:function(e){if(W.video){var t=W.timer.position,n=W.video.findWord(t),r=W.video.findPhrase(t);n&&n.text!==I&&(I=n.text,console.log(I),Se()),r&&r.text!==E&&(E=r.text,J(r.text)),ye(),document.getElementById(\"seekbar\").value=t}},onPlay:function(){document.getElementById(\"playBtn\").disabled=!0,document.getElementById(\"pauseBtn\").disabled=!1},onPause:function(){document.getElementById(\"playBtn\").disabled=!1,document.getElementById(\"pauseBtn\").disabled=!0}}),V.addEventListener(\"click\",function(){O=H.value;var e=_[O];e&&(document.getElementById(\"startScreen\").classList.add(\"hidden\"),document.getElementById(\"mainApp\").classList.remove(\"hidden\"),W.createFromSongUrl(e.url,{video:e.video}))}),q();var Me=0,be=30,Ie=1e3/be;function Ee(e){requestAnimationFrame(Ee),e-Me<Ie||(Me=e,ve(),le(),oe(),re(),o.update(),r&&n&&r.render(t,n))}function Be(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)}function Pe(e){e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){return e.dispose()}):e.material.dispose())}function Le(){B.forEach(function(e){Pe(e)}),B=[],P.forEach(function(e){t.remove(e.trail),e.trail.geometry.dispose(),e.trail.material.dispose()}),P=[],L.forEach(function(e){t.remove(e),e.geometry.dispose(),e.material.dispose()}),L=[],b&&(t.remove(b),b.geometry.dispose(),b.material.dispose(),b=null),Object.values(x).forEach(function(e){return e.dispose()}),x={},k.forEach(function(e){return Pe(e)}),k=[],t.background&&t.background.isTexture&&t.background.dispose()}function Ae(e,t){var n;return function(){for(var r=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];clearTimeout(n),n=setTimeout(function(){return e.apply(r,i)},t)}}window.addEventListener(\"beforeunload\",Le);var Se=Ae(ue,300);"},"sourceMaps":null,"error":null,"hash":"bef2f0db27513b05a9027da7103979fa","cacheData":{"env":{}}}